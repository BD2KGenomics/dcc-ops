#!/usr/bin/env bash
# Usage: redwood recover {auth|metadata} backup.gz
# Summary: Recover redwood data from backup
# Help: This comand updates the local redwood instance with data from the supplied backup.
# The backup should probably come from the backup_bucket of a previous redwood instance.

function recover_auth() {
    auth_dump=$1
    echo recovering auth data from backup file ${auth_dump}
}

function recover_metadata() {
    metadata_dump=$1
    echo recovering metadata from backup file ${metadata_dump}
    echo docker cp "${metadata_dump}" redwood-metadata-db:/tmp/
    echo docker exec redwood-metadata-db "cd /tmp && tar xvf ${metadata_dump} && mongorestore dump"
}

case "${1^^}" in
    A|AUTH)
        recover_auth $2
        ;;
    M|META|METADATA)
        recover_metadata $2
        ;;
    *)
        echo error: invalid service: must be one of auth or metadata
        exit 1
        ;;
esac
